import openpyxl
from openpyxl.chart import BarChart, Reference
from openpyxl.styles import Font, Alignment

# Create a workbook and select the active worksheet
wb = openpyxl.Workbook()

# Create sheets for different sections
sheets = ['Data Input', 'Charts & Graphs', 'KPIs', 'Sub KPIs', 'Activity', 'PFS']
for sheet in sheets:
    wb.create_sheet(title=sheet)

# Remove the default sheet
wb.remove(wb['Sheet'])

# Define a function to create headers
def create_headers(sheet, headers, start_row=1, start_col=1):
    for col_num, header in enumerate(headers, start_col):
        cell = sheet.cell(row=start_row, column=col_num)
        cell.value = header
        cell.font = Font(bold=True)
        cell.alignment = Alignment(horizontal='center')

# Define headers for each sheet
data_input_headers = ['Date', 'Category', 'Description', 'Frequency', 'Duration (min)', 'Vendor Part Fallout',
                      'TM Struggle Points', 'General Process Condition', 'Notes']
kpi_headers = ['Main KPI', 'Value', 'Target', 'Status']
sub_kpi_headers = ['Main KPI', 'Sub KPI', 'Value', 'Target', 'Status']
activity_headers = ['Date', 'Activity', 'Responsible', 'Status', 'Notes']
pfs_headers = ['Problem', 'Root Cause', 'Solution', 'Responsible', 'Status', 'Due Date']

# Add headers to sheets
create_headers(wb['Data Input'], data_input_headers)
create_headers(wb['KPIs'], kpi_headers)
create_headers(wb['Sub KPIs'], sub_kpi_headers)
create_headers(wb['Activity'], activity_headers)
create_headers(wb['PFS'], pfs_headers)

# Add sample data to 'Data Input'
data_input_sample_data = [
    ['2025-03-01', 'Downtime', 'Machine breakdown', 5, 60, 'N/A', 'Operator error', 'Poor maintenance', 'Urgent'],
    ['2025-03-02', 'Defects', 'Vendor part defect', 10, 30, 'Defective batch', 'N/A', 'Good', 'High priority'],
]

for row in data_input_sample_data:
    wb['Data Input'].append(row)

# Create a bar chart for 'KPIs'
kpi_chart = BarChart()
kpi_chart.title = "KPI Performance"
kpi_chart.y_axis.title = 'Value'
kpi_chart.x_axis.title = 'KPI'

data = Reference(wb['KPIs'], min_col=2, min_row=1, max_row=5, max_col=2)
categories = Reference(wb['KPIs'], min_col=1, min_row=2, max_row=5)
kpi_chart.add_data(data, titles_from_data=True)
kpi_chart.set_categories(categories)
kpi_chart.shape = 4
wb['Charts & Graphs'].add_chart(kpi_chart, "A10")

# Save the workbook
wb.save('KPI_Management_Dashboard.xlsx')

print("KPI Management Dashboard created successfully!")
